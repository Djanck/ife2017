!function(t,e){if("function"==typeof define&&define.amd)define(["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var i={exports:{}};e(i.exports),t.index=i.exports}}(this,function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),s={bg_texture:"../dist/images/wood.png",rows:20,cols:20,size:30,dir:"bottom",body:[0,1,2,3,4,5,6,7,8,9,10],speed:100},n={left:"right",right:"left",top:"bottom",bottom:"top"},h=function(){function t(i,n){e(this,t),Object.assign(this,s,n),this.canvas=document.getElementById(i),this.cxt=this.canvas.getContext("2d"),this.isAnimate=!1,this.init()}return i(t,[{key:"init",value:function(){this.width=this.cols*this.size,this.height=this.rows*this.size,this.setSize(),this.getMaps(),this.bindEvent(),this.loadBgImg(this.start)}},{key:"getMaps",value:function(){this.maps={top:-this.cols,bottom:this.cols,left:-1,right:1}}},{key:"destory",value:function(){this.cxt.clearRect(0,0,this.width,this.height),this.stop()}},{key:"bindEvent",value:function(){document.addEventListener("keydown",this.getKeyCode.bind(this)),this.canvas.addEventListener("mousemove",this.getMousePos.bind(this))}},{key:"getKeyCode",value:function(t){switch(t.keyCode){case 87:case 38:return this.setDir("top");case 65:case 37:return this.setDir("left");case 39:case 68:return this.setDir("right");case 40:case 83:return this.setDir("bottom");default:return!1}}},{key:"getMousePos",value:function(t){this.mx=t.clientX-this.bounds.left,this.my=t.clientY-this.bounds.top}},{key:"setSize",value:function(){this.canvas.width=this.width,this.canvas.height=this.height,this.bounds=this.canvas.getBoundingClientRect()}},{key:"start",value:function(){var t=this;this.isAnimate=!0,this.addApple();var e=function i(){setTimeout(function(){return!!t.isAnimate&&(t.cxt.clearRect(0,0,t.width,t.height),t.render(),t.update(),void i())},t.speed)};e()}},{key:"stop",value:function(){this.isAnimate=!1}},{key:"gameover",value:function(){this.stop(),this.renderBg(),this.renderSnake("#999")}},{key:"render",value:function(){this.renderBg(),this.renderSnake(),this.renderApple()}},{key:"loadBgImg",value:function(t){var e=this;this.image=new Image,this.image.onload=function(){t.apply(e)},this.image.src=this.bg_texture}},{key:"renderBg",value:function(){this.cxt.fillStyle=this.cxt.createPattern(this.image,"repeat"),this.cxt.fillRect(0,0,this.width,this.height)}},{key:"renderApple",value:function(){if(this.apple){var t=this.getCoord(this.apple),e=t.x,i=t.y;this.cxt.fillStyle="#d71345",this.cxt.beginPath(),this.cxt.arc(e*this.size+this.size/2,i*this.size+this.size/2,this.size/2,0,2*Math.PI,!0),this.cxt.closePath(),this.cxt.fill()}}},{key:"getCoord",value:function(t){return{x:t%this.cols,y:~~(t/this.cols)}}},{key:"setDir",value:function(t){return t!==this.dir&&t!==n[this.dir]&&void(this.dir=t)}},{key:"renderSnake",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#000";this.cxt.fillStyle=e,Array.from(this.body,function(e,i){var s=t.getCoord(e),n=s.x,h=s.y;t.cxt.fillRect(n*t.size,h*t.size,t.size,t.size)})}},{key:"isFailed",value:function(t){var e=this.getCoord(t),i=e.x,s=e.y;return 0===i&&"left"===this.dir?(this.gameover(),!0):i===this.cols-1&&"right"===this.dir?(this.gameover(),!0):0===s&&"top"===this.dir?(this.gameover(),!0):s===this.rows-1&&"bottom"===this.dir?(this.gameover(),!0):void 0}},{key:"getSelfDir",value:function(t,e){var i=e-t;for(var s in this.maps)if(i===this.maps[s])return s}},{key:"update",value:function(){var t=this,e=this.body,i=e[e.length-1],s=e[0],n=i+this.maps[this.dir];return this.isFailed(i)||e.indexOf(n)>-1?this.gameover():(this.body=Array.from(this.body,function(i,s){return s===e.length-1?n:i+t.maps[t.getSelfDir(i,e[s+1])]}),void(n===this.apple&&(this.apple=null,this.body.unshift(s),this.speed-=1,setTimeout(function(){t.addApple()},1e3))))}},{key:"getRandom",value:function(){return~~(Math.random()*this.cols*this.rows)}},{key:"addApple",value:function(){for(var t=this.body[0];this.body.indexOf(t)>-1;)t=this.getRandom();this.apple=t}}]),t}();t["default"]=h});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImphdmFzY3JpcHRzL1NuYWtlL2luZGV4LmpzIl0sIm5hbWVzIjpbImdsb2JhbCIsImZhY3RvcnkiLCJkZWZpbmUiLCJhbWQiLCJleHBvcnRzIiwibW9kIiwiaW5kZXgiLCJ0aGlzIiwiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJDb25zdHJ1Y3RvciIsIlR5cGVFcnJvciIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwidmFsdWUiLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJpIiwibGVuZ3RoIiwiZGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsImtleSIsInByb3RvUHJvcHMiLCJzdGF0aWNQcm9wcyIsInByb3RvdHlwZSIsIl9kZWZhdWx0IiwiYmdfdGV4dHVyZSIsInJvd3MiLCJjb2xzIiwic2l6ZSIsImRpciIsImJvZHkiLCJzcGVlZCIsImRpck1hcCIsImxlZnQiLCJyaWdodCIsInRvcCIsImJvdHRvbSIsIlNuYWtlIiwiaWQiLCJvcHRpb24iLCJhc3NpZ24iLCJjYW52YXMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiY3h0IiwiZ2V0Q29udGV4dCIsImlzQW5pbWF0ZSIsImluaXQiLCJ3aWR0aCIsImhlaWdodCIsInNldFNpemUiLCJnZXRNYXBzIiwiYmluZEV2ZW50IiwibG9hZEJnSW1nIiwic3RhcnQiLCJtYXBzIiwiY2xlYXJSZWN0Iiwic3RvcCIsImFkZEV2ZW50TGlzdGVuZXIiLCJnZXRLZXlDb2RlIiwiYmluZCIsImdldE1vdXNlUG9zIiwiZSIsImtleUNvZGUiLCJzZXREaXIiLCJteCIsImNsaWVudFgiLCJib3VuZHMiLCJteSIsImNsaWVudFkiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJfdGhpcyIsImFkZEFwcGxlIiwidGltZXIiLCJzZXRUaW1lb3V0IiwicmVuZGVyIiwidXBkYXRlIiwicmVuZGVyQmciLCJyZW5kZXJTbmFrZSIsInJlbmRlckFwcGxlIiwiY2FsbGJhY2siLCJfdGhpczIiLCJpbWFnZSIsIkltYWdlIiwib25sb2FkIiwiYXBwbHkiLCJzcmMiLCJmaWxsU3R5bGUiLCJjcmVhdGVQYXR0ZXJuIiwiZmlsbFJlY3QiLCJhcHBsZSIsIl9nZXRDb29yZCIsImdldENvb3JkIiwieCIsInkiLCJiZWdpblBhdGgiLCJhcmMiLCJNYXRoIiwiUEkiLCJjbG9zZVBhdGgiLCJmaWxsIiwiX3RoaXMzIiwiY29sb3IiLCJhcmd1bWVudHMiLCJ1bmRlZmluZWQiLCJBcnJheSIsImZyb20iLCJwb3MiLCJfZ2V0Q29vcmQyIiwiX2dldENvb3JkMyIsImdhbWVvdmVyIiwicG9zMSIsInBvczIiLCJkIiwiX3RoaXM0IiwiaGVhZCIsInRhaWwiLCJuZXh0SGVhZCIsImlzRmFpbGVkIiwiaW5kZXhPZiIsImdldFNlbGZEaXIiLCJ1bnNoaWZ0IiwicmFuZG9tIiwiZ2V0UmFuZG9tIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFXQSxFQUFRQyxHQUNmLEdBQXNCLGtCQUFYQyxTQUF5QkEsT0FBT0MsSUFDdkNELFFBQVEsV0FBWUQsT0FDakIsSUFBdUIsbUJBQVpHLFNBQ2RILEVBQVFHLGFBQ0wsQ0FDSCxHQUFJQyxJQUNBRCxXQUVKSCxHQUFRSSxFQUFJRCxTQUNaSixFQUFPTSxNQUFRRCxFQUFJRCxVQUV4QkcsS0FBTSxTQUFVSCxHQVpuQixZQW1CSSxTQUFTSSxHQUFnQkMsRUFBVUMsR0FDL0IsS0FBTUQsWUFBb0JDLElBQ3RCLEtBQU0sSUFBSUMsV0FBVSxxQ0FONUJDLE9BQU9DLGVBQWVULEVBQVMsY0FDM0JVLE9BQU8sR0FTWCxJQUFJQyxHQUFlLFdBQ2YsUUFBU0MsR0FBaUJDLEVBQVFDLEdBQzlCLElBQUssR0FBSUMsR0FBSSxFQUFHQSxFQUFJRCxFQUFNRSxPQUFRRCxJQUFLLENBQ25DLEdBQUlFLEdBQWFILEVBQU1DLEVBQ3ZCRSxHQUFXQyxXQUFhRCxFQUFXQyxhQUFjLEVBQ2pERCxFQUFXRSxjQUFlLEVBQ3RCLFNBQVdGLEtB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LEtBQU8zQixNQUFLcUQsS0FDakIsR0FBSTBELElBQU0vRyxLQUFLcUQsS0FBSzFCLEdBQ2hCLE1BQU9BLE1BdUZYVCxJQUFLLFNBQ0xYLE1BQU8sV0FuRlQsR0FBQXlHLEdBQUFoSCxLQUNJNEIsRUFBUzVCLEtBQVQ0QixLQUNGcUYsRUFBT3JGLEVBQUtBLEVBQUtmLE9BQVMsR0FDMUJxRyxFQUFPdEYsRUFBSyxHQUNadUYsRUFBV0YsRUFBT2pILEtBQUtxRCxLQUFLckQsS0FBSzJCLElBQ3JDLE9BQUczQixNQUFLb0gsU0FBU0gsSUFBU3JGLEVBQUt5RixRQUFRRixNQUM1Qm5ILEtBQUs0RyxZQUVoQjVHLEtBQUs0QixLQUFPMkUsTUFBTUMsS0FBS3hHLEtBQUs0QixLQUFNLFNBQUM2RSxFQUFLN0YsR0FDcEMsTUFBSUEsS0FBTWdCLEVBQUtmLE9BQVMsRUFDYnNHLEVBR0FWLEVBQU1PLEVBQUszRCxLQUFLMkQsRUFBS00sV0FBV2IsRUFBSzdFLEVBQUtoQixFQUFJLFlBR3pEdUcsSUFBYW5ILEtBQUt3RixRQUNsQnhGLEtBQUt3RixNQUFRLEtBQ2J4RixLQUFLNEIsS0FBSzJGLFFBQVFMLEdBQ2xCbEgsS0FBSzZCLE9BQVMsRUFDZDJDLFdBQVcsV0FDUHdDLEVBQUsxQyxZQUNOLFdBeUZIcEQsSUFBSyxZQUNMWCxNQUFPLFdBckZYLFNBQVV3RixLQUFLeUIsU0FBV3hILEtBQUt5QixLQUFPekIsS0FBS3dCLFNBeUZ2Q04sSUFBSyxXQUNMWCxNQUFPLFdBckZYLElBREEsR0FBSWlGLEdBQVF4RixLQUFLNEIsS0FBSyxHQUNoQjVCLEtBQUs0QixLQUFLeUYsUUFBUTdCLE9BQ3BCQSxFQUFReEYsS0FBS3lILFdBRWpCekgsTUFBS3dGLE1BQVFBLE1BMkZOckQsSUFHWHRDLEdBQUFBLFdBL1RpQnNDIiwiZmlsZSI6ImphdmFzY3JpcHRzL1NuYWtlL2luZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnXHJcblxyXG5jb25zdCBfZGVmYXVsdCA9IHtcclxuICAgIGJnX3RleHR1cmU6ICcuLi9kaXN0L2ltYWdlcy93b29kLnBuZycsXHJcbiAgICByb3dzOiAyMCxcclxuICAgIGNvbHM6IDIwLFxyXG4gICAgc2l6ZTogMzAsXHJcbiAgICBkaXI6ICdib3R0b20nLFxyXG4gICAgYm9keTogWzAsIDEsIDIsIDMsIDQsIDUsIDYsIDcsIDgsIDksIDEwXSxcclxuICAgIHNwZWVkOiAxMDBcclxufVxyXG5cclxuY29uc3QgZGlyTWFwID0ge1xyXG4gICAgbGVmdDogJ3JpZ2h0JyxcclxuICAgIHJpZ2h0OiAnbGVmdCcsXHJcbiAgICB0b3A6ICdib3R0b20nLFxyXG4gICAgYm90dG9tOiAndG9wJ1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTbmFrZSB7XHJcblx0Y29uc3RydWN0b3IoaWQsIG9wdGlvbikge1xyXG5cdFx0T2JqZWN0LmFzc2lnbih0aGlzLCBfZGVmYXVsdCwgb3B0aW9uKVxyXG5cdFx0dGhpcy5jYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZClcclxuXHRcdHRoaXMuY3h0ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxyXG5cdFx0dGhpcy5pc0FuaW1hdGUgPSBmYWxzZVxyXG5cdFx0dGhpcy5pbml0KClcclxuXHR9XHJcbiAgICAvLyAg5ri45oiP5Yid5aeL5YyWXHJcblx0aW5pdCgpIHtcclxuICAgICAgICB0aGlzLndpZHRoID0gdGhpcy5jb2xzICogdGhpcy5zaXplXHJcbiAgICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLnJvd3MgKiB0aGlzLnNpemVcclxuXHRcdHRoaXMuc2V0U2l6ZSgpXHJcbiAgICAgICAgdGhpcy5nZXRNYXBzKClcclxuICAgICAgICB0aGlzLmJpbmRFdmVudCgpXHJcbiAgICAgICAgdGhpcy5sb2FkQmdJbWcodGhpcy5zdGFydClcclxuXHR9XHJcbiAgICAvLyAg6I635b6X5pa55ZCR5a+55bqU55qE5pWw5YC8XHJcbiAgICBnZXRNYXBzKCkgeyAgICAgICAgXHJcbiAgICAgICAgdGhpcy5tYXBzID0ge1xyXG4gICAgICAgICAgICB0b3A6IC10aGlzLmNvbHMsXHJcbiAgICAgICAgICAgIGJvdHRvbTogdGhpcy5jb2xzLFxyXG4gICAgICAgICAgICBsZWZ0OiAtMSxcclxuICAgICAgICAgICAgcmlnaHQ6IDFcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyAg5LiA5YiH6YO95a6M5LqGXHJcblx0ZGVzdG9yeSgpIHtcclxuXHRcdHRoaXMuY3h0LmNsZWFyUmVjdCgwLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodClcclxuXHRcdHRoaXMuc3RvcCgpXHJcblx0fVxyXG4gICAgLy8gIOe7keWumuS6i+S7tlxyXG5cdGJpbmRFdmVudCgpIHtcclxuXHRcdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLmdldEtleUNvZGUuYmluZCh0aGlzKSlcclxuXHRcdHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMuZ2V0TW91c2VQb3MuYmluZCh0aGlzKSlcclxuXHR9XHJcbiAgICAvLyAg6I635b6X6ZSu55uY5pON5L2cXHJcbiAgICBnZXRLZXlDb2RlKGUpIHtcclxuICAgICAgICBzd2l0Y2goZS5rZXlDb2RlKXtcclxuICAgICAgICAgICAgY2FzZSA4NzpcclxuICAgICAgICAgICAgY2FzZSAzODpcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNldERpcigndG9wJykvL3dcclxuICAgICAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICAgIGNhc2UgNjU6XHJcbiAgICAgICAgICAgIGNhc2UgMzc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZXREaXIoJ2xlZnQnKS8vYVxyXG4gICAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgY2FzZSAzOTpcclxuICAgICAgICAgICAgY2FzZSA2ODpcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNldERpcigncmlnaHQnKS8vZFxyXG4gICAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgY2FzZSA0MDpcclxuICAgICAgICAgICAgY2FzZSA4MzpcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNldERpcignYm90dG9tJykvL3NcclxuICAgICAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyAg5b6X5Yiw6byg5qCH5L2N572u77yM5rKh5LuA5LmI5Y2155So55qE5qC35a2QXHJcblx0Z2V0TW91c2VQb3MoZSkge1xyXG5cdCAgICB0aGlzLm14ID0gZS5jbGllbnRYIC0gdGhpcy5ib3VuZHMubGVmdFxyXG5cdFx0dGhpcy5teSA9IGUuY2xpZW50WSAtIHRoaXMuYm91bmRzLnRvcFxyXG5cdH1cclxuICAgIC8vICDliJ3lp4vljJblsLrlr7hcclxuXHRzZXRTaXplKCkge1xyXG5cdFx0dGhpcy5jYW52YXMud2lkdGggPSB0aGlzLndpZHRoXHJcblx0XHR0aGlzLmNhbnZhcy5oZWlnaHQgPSB0aGlzLmhlaWdodFxyXG4gICAgICAgIHRoaXMuYm91bmRzID0gdGhpcy5jYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcclxuXHR9XHJcbiAgICAvLyAg5byA5aeL5ri45oiPXHJcblx0c3RhcnQoKSB7XHJcblx0XHR0aGlzLmlzQW5pbWF0ZSA9IHRydWVcclxuXHJcbiAgICAgICAgdGhpcy5hZGRBcHBsZSgpXHJcblx0XHRjb25zdCB0aW1lciA9ICgpID0+IHtcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNBbmltYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN4dC5jbGVhclJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpXHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcigpXHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZSgpXHJcbiAgICAgICAgICAgICAgICB0aW1lcigpXHJcbiAgICAgICAgICAgIH0sIHRoaXMuc3BlZWQpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRpbWVyKClcclxuXHRcdC8vIGNvbnN0IHN0ZXAgPSAoKSA9PiB7XHJcblx0XHQvLyBcdGlmICghdGhpcy5pc0FuaW1hdGUpIHJldHVybiBmYWxzZVxyXG5cdFx0Ly8gXHR0aGlzLnJlbmRlcigpXHJcblx0XHQvLyBcdHRoaXMudXBkYXRlKClcclxuXHRcdC8vIFx0cmVxdWVzdEFuaW1hdGlvbkZyYW1lKHN0ZXApXHJcblx0XHQvLyB9XHJcblx0XHQvLyByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoc3RlcClcclxuXHR9XHJcbiAgICAvLyAg5pqC5YGc5ri45oiPXHJcblx0c3RvcCgpIHtcclxuXHRcdHRoaXMuaXNBbmltYXRlID0gZmFsc2VcclxuXHR9XHJcbiAgICAvLyAg5ri45oiP57uT5p2fXHJcbiAgICBnYW1lb3ZlcigpIHtcclxuICAgICAgICB0aGlzLnN0b3AoKVxyXG4gICAgICAgIHRoaXMucmVuZGVyQmcoKVxyXG4gICAgICAgIHRoaXMucmVuZGVyU25ha2UoJyM5OTknKVxyXG4gICAgfVxyXG4gICAgLy8gIOa4suafk1xyXG4gICAgcmVuZGVyKCkge1xyXG4gICAgICAgIHRoaXMucmVuZGVyQmcoKVxyXG4gICAgICAgIHRoaXMucmVuZGVyU25ha2UoKVxyXG4gICAgICAgIHRoaXMucmVuZGVyQXBwbGUoKVxyXG4gICAgfVxyXG4gICAgLy8gIOWKoOi9veiDjOaZr1xyXG4gICAgbG9hZEJnSW1nKGNhbGxiYWNrKSB7XHJcblx0XHR0aGlzLmltYWdlID0gbmV3IEltYWdlKClcclxuXHRcdHRoaXMuaW1hZ2Uub25sb2FkID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBjYWxsYmFjay5hcHBseSh0aGlzKVxyXG5cdFx0fVxyXG5cdFx0dGhpcy5pbWFnZS5zcmMgPSB0aGlzLmJnX3RleHR1cmVcclxuICAgIH1cclxuICAgIC8vICDnlLvog4zmma9cclxuICAgIHJlbmRlckJnKCkge1xyXG4gICAgICAgIHRoaXMuY3h0LmZpbGxTdHlsZSA9IHRoaXMuY3h0LmNyZWF0ZVBhdHRlcm4odGhpcy5pbWFnZSwgJ3JlcGVhdCcpXHJcbiAgICAgICAgdGhpcy5jeHQuZmlsbFJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpXHJcbiAgICB9XHJcbiAgICAvLyAg55S75Liq6Iu55p6cXHJcbiAgICByZW5kZXJBcHBsZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5hcHBsZSkge1xyXG4gICAgICAgICAgICBsZXQgeyB4LCB5IH0gPSB0aGlzLmdldENvb3JkKHRoaXMuYXBwbGUpXHJcbiAgICAgICAgICAgIHRoaXMuY3h0LmZpbGxTdHlsZSA9ICcjZDcxMzQ1J1xyXG5cclxuICAgICAgICAgICAgdGhpcy5jeHQuYmVnaW5QYXRoKClcclxuICAgICAgICAgICAgdGhpcy5jeHQuYXJjKHggKiB0aGlzLnNpemUgKyB0aGlzLnNpemUgLyAyLCB5ICogdGhpcy5zaXplICsgdGhpcy5zaXplIC8gMiwgdGhpcy5zaXplIC8gMiwgMCwgMiAqIE1hdGguUEksIHRydWUpXHJcbiAgICAgICAgICAgIHRoaXMuY3h0LmNsb3NlUGF0aCgpXHJcblxyXG4gICAgICAgICAgICB0aGlzLmN4dC5maWxsKClcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyAg5qC55o2u57Si5byV6I635b6X5Z2Q5qCHXHJcbiAgICBnZXRDb29yZChpbmRleCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcblx0XHRcdHg6IGluZGV4ICUgdGhpcy5jb2xzLFxyXG5cdFx0XHR5OiB+fihpbmRleCAvIHRoaXMuY29scylcclxuXHRcdH1cclxuICAgIH1cclxuICAgIC8vICDorr7nva7mlrnlkJFcclxuICAgIHNldERpcihkaXIpIHtcclxuICAgICAgICAvLyAg5ZCM5pa55ZCR5oiW6ICF55u45Y+N5pa55ZCR5bCx566X5LqGXHJcbiAgICAgICAgaWYgKGRpciA9PT0gdGhpcy5kaXIgfHwgZGlyID09PSBkaXJNYXBbdGhpcy5kaXJdKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmRpciA9IGRpclxyXG4gICAgfVxyXG4gICAgLy8gIOeUu+adoeibh1xyXG5cdHJlbmRlclNuYWtlKGNvbG9yID0gJyMwMDAnKSB7XHJcblx0XHR0aGlzLmN4dC5maWxsU3R5bGUgPSBjb2xvclxyXG5cdFx0QXJyYXkuZnJvbSh0aGlzLmJvZHksIChwb3MsIGkpID0+IHtcclxuICAgICAgICAgICAgbGV0IHsgeCwgeSB9ID0gdGhpcy5nZXRDb29yZChwb3MpXHJcbiAgICAgICAgICAgIHRoaXMuY3h0LmZpbGxSZWN0KHggKiB0aGlzLnNpemUsIHkgKiB0aGlzLnNpemUsIHRoaXMuc2l6ZSwgdGhpcy5zaXplKVxyXG5cdFx0fSlcclxuXHR9XHJcbiAgICAvLyAg5piv5LiN5piv5Ye655WM5LqGXHJcbiAgICBpc0ZhaWxlZChpbmRleCkge1xyXG4gICAgICAgIGxldCB7IHgsIHkgfSA9IHRoaXMuZ2V0Q29vcmQoaW5kZXgpXHJcbiAgICAgICAgaWYgKHggPT09IDAgJiYgdGhpcy5kaXIgPT09ICdsZWZ0Jykge1xyXG4gICAgICAgICAgICB0aGlzLmdhbWVvdmVyKClcclxuICAgICAgICAgICAgcmV0dXJuIHRydWVcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHggPT09IHRoaXMuY29scyAtIDEgJiYgdGhpcy5kaXIgPT09ICdyaWdodCcpIHtcclxuICAgICAgICAgICAgdGhpcy5nYW1lb3ZlcigpXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh5ID09PSAwICYmIHRoaXMuZGlyID09PSAndG9wJykge1xyXG4gICAgICAgICAgICB0aGlzLmdhbWVvdmVyKClcclxuICAgICAgICAgICAgcmV0dXJuIHRydWVcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHkgPT09IHRoaXMucm93cyAtIDEgJiYgdGhpcy5kaXIgPT09ICdib3R0b20nKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2FtZW92ZXIoKVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vICDkuKTngrnnoa7lrprmlrnlkJFcclxuICAgIGdldFNlbGZEaXIocG9zMSwgcG9zMikge1xyXG4gICAgICAgIGxldCBkID0gcG9zMiAtIHBvczFcclxuICAgICAgICBmb3IgKGxldCBkaXIgaW4gdGhpcy5tYXBzKSB7XHJcbiAgICAgICAgICAgIGlmIChkID09PSB0aGlzLm1hcHNbZGlyXSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRpclxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gIOa4suafk+abtOaWsFxyXG5cdHVwZGF0ZSgpIHtcclxuICAgICAgICBsZXQgeyBib2R5IH0gPSB0aGlzXHJcbiAgICAgICAgbGV0IGhlYWQgPSBib2R5W2JvZHkubGVuZ3RoIC0gMV1cclxuICAgICAgICBsZXQgdGFpbCA9IGJvZHlbMF1cclxuICAgICAgICBsZXQgbmV4dEhlYWQgPSBoZWFkICsgdGhpcy5tYXBzW3RoaXMuZGlyXVxyXG4gICAgICAgIGlmKHRoaXMuaXNGYWlsZWQoaGVhZCkgfHwgYm9keS5pbmRleE9mKG5leHRIZWFkKSA+IC0xKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdhbWVvdmVyKClcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5ib2R5ID0gQXJyYXkuZnJvbSh0aGlzLmJvZHksIChwb3MsIGkpID0+IHtcclxuICAgICAgICAgICAgaWYgKGkgPT09IGJvZHkubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5leHRIZWFkXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcG9zICsgdGhpcy5tYXBzW3RoaXMuZ2V0U2VsZkRpcihwb3MsIGJvZHlbaSArIDFdKV1cclxuICAgICAgICAgICAgfVxyXG5cdFx0fSlcclxuICAgICAgICBpZiAobmV4dEhlYWQgPT09IHRoaXMuYXBwbGUpIHtcclxuICAgICAgICAgICAgdGhpcy5hcHBsZSA9IG51bGxcclxuICAgICAgICAgICAgdGhpcy5ib2R5LnVuc2hpZnQodGFpbClcclxuICAgICAgICAgICAgdGhpcy5zcGVlZCAtPSAxXHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZGRBcHBsZSgpXHJcbiAgICAgICAgICAgIH0sIDEwMDApXHJcbiAgICAgICAgfVxyXG5cdH1cclxuICAgIC8vICDpmo/mnLrkuIDkuKrmlbDlrZdcclxuICAgIGdldFJhbmRvbSgpIHtcclxuICAgICAgICByZXR1cm4gfn4oTWF0aC5yYW5kb20oKSAqIHRoaXMuY29scyAqIHRoaXMucm93cylcclxuICAgIH1cclxuICAgIC8vICDliqDkuKrmnpzlrZBcclxuICAgIGFkZEFwcGxlKCkge1xyXG4gICAgICAgIGxldCBhcHBsZSA9IHRoaXMuYm9keVswXVxyXG4gICAgICAgIHdoaWxlKHRoaXMuYm9keS5pbmRleE9mKGFwcGxlKSA+IC0xKSB7XHJcbiAgICAgICAgICAgIGFwcGxlID0gdGhpcy5nZXRSYW5kb20oKVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmFwcGxlID0gYXBwbGVcclxuICAgIH1cclxufSJdfQ==
